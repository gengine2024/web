<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hex Convert & Byte数组处理工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        select {
            width: 200px;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #decimal-input, #hex-input {
            width: 200px;
        }
        .bit-container {
            display: flex;
            gap: 2px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .bit-input {
            width: 24px !important;
            height: 24px;
            text-align: center;
            padding: 2px;
            font-size: 14px;
            cursor: pointer;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            user-select: none;
        }
        .bit-position {
            font-size: 10px;
            text-align: center;
            color: #666;
            width: 24px;
            margin-bottom: 1px;
        }
        .bit-column {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .bit-spacer {
            width: 6px;
        }
        h1 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
        }
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .input-label {
            min-width: 100px;
        }
        .copy-button, button {
            padding: 6px 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        .copy-button:hover, button:hover {
            background-color: #45a049;
        }
        .copy-button:active, button:active {
            background-color: #3d8b40;
        }
        .binary-container {
            display: flex;
            align-items: center;
        }
        .byte-group-0 {
            background-color: #f0f8ff; /* 浅蓝色 */
        }
        .byte-group-1 {
            background-color: #fff0f0; /* 浅红色 */
        }
        .byte-group-2 {
            background-color: #f0fff0; /* 浅绿色 */
        }
        .byte-group-3 {
            background-color: #fff8f0; /* 浅橙色 */
        }
        .byte-group-4 {
            background-color: #f8f0ff; /* 浅紫色 */
        }
        .byte-group-5 {
            background-color: #f0ffff; /* 浅青色 */
        }
        .byte-group-6 {
            background-color: #fffff0; /* 浅黄色 */
        }
        .byte-group-7 {
            background-color: #f8f8f8; /* 浅灰色 */
        }
        textarea {
            width: 100%;
            min-height: 100px;
            resize: vertical;
        }
        .radio-group {
            display: flex;
            gap: 1.5rem;
            margin: 0.5rem 0;
        }
        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .output-group {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .output-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        #outputResult {
            white-space: pre-wrap;
            word-break: break-all;
            font-family: monospace;
        }
        .section-divider {
            height: 1px;
            background-color: #ddd;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hex Convert</h1>
        
        <div class="input-group">
            <div class="input-row">
                <label class="input-label" for="size-select">Select：</label>
                <select id="size-select">
                    <option value="8">1 byte (8 bit)</option>
                    <option value="16">2 byte (16 bit)</option>
                    <option value="32">4 byte (32 bit)</option>
                    <option value="64">8 byte (64 bit)</option>
                </select>
            </div>
        </div>

        <div class="input-group">
            <div class="input-row">
                <label class="input-label" for="decimal-input">DEC：</label>
                <input type="text" id="decimal-input" placeholder="Please input DEC">
            </div>
        </div>

        <div class="input-group">
            <div class="input-row">
                <label class="input-label">BIN：</label>
                <div class="binary-container">
                    <div id="binary-inputs" class="bit-container"></div>
                    <button class="copy-button" onclick="copyBinary()">Copy</button>
                </div>
            </div>
        </div>

        <div class="input-group">
            <div class="input-row">
                <label class="input-label" for="hex-input">HEX：</label>
                <input type="text" id="hex-input" placeholder="Please input HEX">
            </div>
        </div>
    </div>

    <div class="section-divider"></div>

    <div class="container">
        <h1>Byte数组格式化与CheckSum计算工具</h1>
        
        <!-- 第一个输入框 -->
        <div class="input-group">
            <div class="input-row">
                <label class="input-label">输入内容(数据类型):</label>
                <div class="radio-group" id="radio_input_group">
                    <div class="radio-item">
                        <input type="radio" id="radio_input_hex" name="data_type" checked>
                        <label for="radio_input_hex">16进制</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="radio_input_dec" name="data_type" >
                        <label for="radio_input_dec">10进制</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="radio_input_edid" name="data_type" >
                        <label for="radio_input_dec">EDID</label>
                    </div>
                </div>
            </div>
            <textarea id="input1" placeholder="eg1: 0xA0 0x54 0x6E 0x10&#10;eg2: 160 84 110 16&#10;&#10;eg3: 0xA0, 0x54, 0x6E, 0x10&#10;eg4: 160, 84, 110, 16"></textarea>
        </div>
        
        <!-- 第二个输入框 -->
        <div class="input-group">
            <label for="input2">转换后数据:</label>
            <!-- 选项设置 -->
            <div class="input-row">
                <div style="margin-right: 20px;">
                    <label for="delimiter">分隔符选择</label>
                    <select id="delimiter">
                        <option value="space">空格</option>
                        <option value="comma">逗号</option>
                    </select>
                </div>
                <div>
                    <label for="outputType">输出类型选择</label>
                    <select id="outputType">
                        <option value="hex_with0x">16进制（0x前缀）</option>
                        <option value="hex">16进制（不带0x前缀）</option>
                        <option value="dec">10进制</option>
                    </select>
                </div>
            </div>
            <textarea id="input2"></textarea>
        </div>
        
        <!-- 功能按钮 -->
        <div class="input-row">
            <button id="formatBtn">格式化Byte数组</button>
            <button id="checkSumBtn">计算CheckSum</button>
        </div>
        
        <!-- 输出结果区域 -->
        <div class="output-group">
            <div class="output-title">处理结果：</div>
            <pre id="outputResult"></pre>
        </div>
    </div>

    <script>
        // 第一部分：Hex Convert 功能
        let currentBits = 8;
        
        function createBinaryInputs(bits) {
            const container = document.getElementById('binary-inputs');
            container.innerHTML = '';
            
            for (let i = bits - 1; i >= 0; i--) {
                const column = document.createElement('div');
                column.className = 'bit-column';
                
                const position = document.createElement('div');
                position.className = 'bit-position';
                position.textContent = i;
                
                const button = document.createElement('button');
                button.className = 'bit-input';
                const byteGroup = Math.floor(i / 8);
                button.classList.add(`byte-group-${byteGroup}`);
                
                button.dataset.position = i;
                button.textContent = '0';
                
                button.addEventListener('click', (e) => {
                    const currentValue = e.target.textContent;
                    e.target.textContent = currentValue === '0' ? '1' : '0';
                    updateFromBinary();
                });
                
                column.appendChild(position);
                column.appendChild(button);
                container.appendChild(column);
                
                if (i > 0 && i % 4 === 0) {
                    const spacer = document.createElement('div');
                    spacer.className = 'bit-spacer';
                    container.appendChild(spacer);
                }
            }
        }

        function updateFromBinary() {
            const buttons = Array.from(document.querySelectorAll('.bit-input'));
            const binaryString = buttons.map(button => button.textContent).join('');
            const decimal = parseInt(binaryString, 2);
            
            document.getElementById('decimal-input').value = decimal;
            document.getElementById('hex-input').value = decimal.toString(16).toUpperCase().padStart(currentBits/4, '0');
        }

        function updateFromDecimal() {
            const decimal = parseInt(document.getElementById('decimal-input').value) || 0;
            const maxValue = Math.pow(2, currentBits) - 1;
            const validDecimal = Math.max(0, Math.min(decimal, maxValue));
            
            const binary = validDecimal.toString(2).padStart(currentBits, '0');
            const hex = validDecimal.toString(16).toUpperCase().padStart(currentBits/4, '0');
            
            document.getElementById('decimal-input').value = validDecimal;
            document.getElementById('hex-input').value = hex;
            
            const buttons = document.querySelectorAll('.bit-input');
            binary.split('').forEach((bit, index) => {
                buttons[index].textContent = bit;
            });
        }

        function updateFromHex() {
            const hex = document.getElementById('hex-input').value;
            const decimal = parseInt(hex, 16) || 0;
            const maxValue = Math.pow(2, currentBits) - 1;
            const validDecimal = Math.max(0, Math.min(decimal, maxValue));
            
            const binary = validDecimal.toString(2).padStart(currentBits, '0');
            
            document.getElementById('decimal-input').value = validDecimal;
            document.getElementById('hex-input').value = validDecimal.toString(16).toUpperCase().padStart(currentBits/4, '0');
            
            const buttons = document.querySelectorAll('.bit-input');
            binary.split('').forEach((bit, index) => {
                buttons[index].textContent = bit;
            });
        }

        function copyBinary() {
            const buttons = Array.from(document.querySelectorAll('.bit-input'));
            const binaryString = buttons.map(button => button.textContent).join('');
            
            // 创建临时文本区域
            const textarea = document.createElement('textarea');
            textarea.value = binaryString;
            document.body.appendChild(textarea);
            
            // 选择并复制文本
            textarea.select();
            document.execCommand('copy');
            
            // 移除临时文本区域
            document.body.removeChild(textarea);
            
            // 更改按钮文字提示复制成功
            const copyButton = document.querySelector('.copy-button');
            const originalText = copyButton.textContent;
            copyButton.textContent = '已复制！';
            setTimeout(() => {
                copyButton.textContent = originalText;
            }, 1000);
        }

        // 第二部分：Byte数组处理工具功能
        // 获取DOM元素
        const input1 = document.getElementById('input1');
        const radio_input_hex = document.getElementById('radio_input_hex');        
        const radio_input_dec = document.getElementById('radio_input_dec');
        const input2 = document.getElementById('input2');
        const delimiterSelect = document.getElementById('delimiter');
        const outputTypeSelect = document.getElementById('outputType');
        const formatBtn = document.getElementById('formatBtn');
        const checkSumBtn = document.getElementById('checkSumBtn');
        const outputResult = document.getElementById('outputResult');

        /**
         * 将多种格式的字符串转换为 Uint8Array 类型的 byte 数组
         * 支持的输入格式示例：
         * - "10 11 12 14 155"（空格分隔十进制）
         * - "10, 11, 12, 14, 155"（逗号+空格分隔十进制）
         * - "0x0a 0x0b 0xc0, 0x10"（混合分隔符十六进制）
         * @param {string} input - 待转换的字符串
         * @param {numble} data_type - 0:十进制，1:十六进制 2:EDID内容
         * @returns {Uint8Array} 转换后的 byte 数组（无符号8位整数数组）
         */
        function stringToByteArray(input, data_type = 1) {
            if (!input.trim()) return new Uint8Array(); // 返回空数组表示失败

            // 处理EDID内容
            if(data_type === 2){
                const edidBytes = extractEDIDFromReg(input);
                if(edidBytes === null){
                    console.error("未找到有效的EDID数据");
                    return new Uint8Array();
                } else {
                    return new Uint8Array(edidBytes);
                }
            }
            
            // 预处理字符串：统一分隔符格式，消除多余空格
            const processed = input
                .replace(/,/g, ' ')       // 将所有逗号替换为空格，统一分隔符类型
                .replace(/\s+/g, ' ')     // 将多个连续空格合并为单个空格（处理"  11  "这类情况）
                .trim();                  // 去除字符串首尾的空格（避免分割出空字符串）
            
            // 按空格分割为独立的数值字符串，并过滤空字符串（处理首尾空格残留）
            const parts = processed.split(' ').filter(part => part);
            
            // 存储解析后的 byte 数值
            const byteArray = [];
            
            // 遍历每个数值片段进行解析
            for (const part of parts) {
                let value; // 存储解析后的数值
                
                // 判断是否为十六进制格式（支持 0x/0X 前缀）
                if(data_type === 1){
                    if (part.startsWith('0x') || part.startsWith('0X')) {
                    // 截取 0x/0X 后的部分，按十六进制解析
                    value = parseInt(part.slice(2), 16);
                    } else {
                        // 非十六进制则按十进制解析
                        value = parseInt(part, 16);
                    }
                } else {
                    value = parseInt(part, 10);
                }
                
                // 严格校验：确保解析结果是有效整数且在 byte 范围（0-255）内
                if (isNaN(value) || !Number.isInteger(value) || value < 0 || value > 255) {
                    console.error(`无效的byte值: ${part} (解析结果: ${value})`);
                    return new Uint8Array(); // 返回空数组表示失败
                }
                
                // 将有效数值加入数组
                byteArray.push(value);
            }
            
            // 转换为标准的 Uint8Array（无符号8位整数数组）返回
            return new Uint8Array(byteArray);
        }

        /**
         * 从注册表内容中提取 EDID 数据
         * @param {string} regContent - 注册表内容字符串
         * @returns {number[] | null} 提取到的 EDID 字节数组，若未找到则返回 null
         */
        function extractEDIDFromReg(regContent) {
            // 匹配EDID字段，包含换行和空格的情况
            const edidRegex = /"EDID"\s*=\s*hex:([\s\S]*?)(?=\r?\n\[|$)/;
            const match = regContent.match(edidRegex);
            
            if (!match) return null;

            // 处理匹配结果：移除换行符、反斜杠、空格和逗号
            let hexStr = match[1]
                .replace(/\\/g, '')    // 移除换行符转义符 \
                .replace(/\s+/g, '')   // 移除所有空格
                .replace(/,/g, '');    // 移除逗号

            // 每两位转换为一个byte
            const edidBytes = [];
            for (let i = 0; i < hexStr.length; i += 2) {
                const byte = parseInt(hexStr.substr(i, 2), 16);
                edidBytes.push(byte);
            }
            
            return edidBytes;
        }

        /**
         * 将 byte 数组格式化为指定风格的字符串
         * @param {Uint8Array | number[]} byteArray - 输入的 byte 数组（Uint8Array 或普通数字数组）
         * @param {Object} options - 格式化选项
         * @param {string} [options.separator=', '] - 分隔符（eg: ', '，' '等）
         * @param {string} [options.format='hex'] - 数值格式（eg: decimal[十进制]，hex[十六进制]）
         * @param {boolean} [options.with0x=true] - 十六进制时是否带 0x 前缀（format 为 hex 时生效）
         * @param {boolean} [options.uppercase=false] - 十六进制时是否大写（format 为 hex 时生效）
         * @returns {string} 格式化后的字符串
         */
        function formatByteArray(byteArray, options = {}) {
            // 默认配置
            const {
                separator = ', ',
                format = 'hex',
                with0x = true,
                uppercase = false
            } = options;

            // 转换为普通数组（兼容 Uint8Array 和普通数组）
            const arr = Array.from(byteArray);

            return arr.map(byte => {
                if (format === 'decimal') {
                    // 十进制格式
                    return byte.toString(10);
                } else if (format === 'hex') {
                    // 十六进制格式
                    let hexStr = byte.toString(16).padStart(2, '0'); // 补零到两位
                    hexStr = uppercase ? hexStr.toUpperCase() : hexStr.toLowerCase();
                    return with0x ? `0x${hexStr}` : hexStr;
                } else {
                    console.error(`不支持的格式: ${format}，可选值：decimal/hex`)
                    return "";
                }
            }).join(separator);
        }

        // 计算CheckSum（异或校验）
        function calculateCheckSum(bytes) {
            if (bytes.length === 0) return '无有效数据，无法计算';

            let checkSum = 0;
            bytes.forEach(byte => {
                checkSum ^= byte; // 异或运算
            });

            // 根据输出类型格式化结果
            const outputType = outputTypeSelect.value;
            if (outputType === 'dec') {
                return `CheckSum（异或校验）: ${checkSum.toString(10)}`;
            } else {
                return `CheckSum（异或校验）: 0x${checkSum.toString(16).padStart(2, '0').toUpperCase()}`;
            }
        }

        // 绑定按钮事件
        formatBtn.addEventListener('click', () => {
            outputResult.textContent = "";
            const bytes = stringToByteArray(input1.value, radio_input_hex.checked ? 1 : (radio_input_dec.checked ? 0 : 2));
            if(bytes.length === 0){
                outputResult.textContent = "输入内容格式不合法";
                return;
            }

            input2.value = formatByteArray(bytes, {
                separator: delimiterSelect.value === 'space' ? ' ' : ', ',
                format: outputTypeSelect.value === 'dec' ? 'decimal' : 'hex',
                with0x: outputTypeSelect.value === 'hex_with0x' ? true : false,
                uppercase: true
            });
        });

        checkSumBtn.addEventListener('click', () => {
            outputResult.textContent = "";
            const bytes = stringToByteArray(input2.value, outputTypeSelect.value === 'dec' ? 0 : 1);
            const bytes1 = stringToByteArray(input1.value, radio_input_hex.checked ? 1 : (radio_input_dec.checked ? 0 : 2));
            if(bytes.length === 0){
                if(bytes1.length === 0){
                    outputResult.textContent = "无有效数据，无法计算";
                    return;
                }

                input2.value = formatByteArray(bytes1, {
                    separator: delimiterSelect.value === 'space' ? ' ' : ', ',
                    format: outputTypeSelect.value === 'dec' ? 'decimal' : 'hex',
                    with0x: outputTypeSelect.value === 'hex_with0x' ? true : false,
                    uppercase: true
                });   
                
                outputResult.textContent = calculateCheckSum(bytes1);             
            } else {
                outputResult.textContent = calculateCheckSum(bytes);
            }

        });

        // 初始化和事件监听
        document.getElementById('size-select').addEventListener('change', (e) => {
            currentBits = parseInt(e.target.value);
            createBinaryInputs(currentBits);
            updateFromBinary();
        });

        document.getElementById('decimal-input').addEventListener('input', updateFromDecimal);
        document.getElementById('hex-input').addEventListener('input', updateFromHex);

        // 初始化页面
        createBinaryInputs(currentBits);
        updateFromBinary();
    </script>
</body>
</html>